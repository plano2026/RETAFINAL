<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RETA FINAL PC SC - ESCRIV√ÉO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@500&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #05070a;
            color: #f8fafc;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 12px;
        }

        .day-card {
            background: #0f172a;
            border: 1px solid #1e293b;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .day-card:hover {
            border-color: #fbbf24;
            background: #161e31;
            transform: translateY(-2px);
        }

        .day-card.completed {
            border-color: #10b981;
            background: #064e3b;
        }

        .simulado-tag {
            background: #fbbf24;
            color: #000;
            font-weight: 900;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .weight-tag {
            border: 1px solid #3b82f6;
            color: #3b82f6;
            font-weight: 700;
            font-size: 8px;
            padding: 1px 4px;
            border-radius: 3px;
            text-transform: uppercase;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #05070a; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }

        .progress-mini {
            height: 3px;
            background: rgba(255,255,255,0.05);
            width: 100%;
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- HEADER -->
        <header class="flex flex-col md:flex-row justify-between items-end mb-10 border-b border-slate-800 pb-10 gap-6">
            <div>
                <h1 class="text-5xl md:text-6xl font-black tracking-tighter italic uppercase leading-none">
                    RETA FINAL <span class="text-yellow-500">PC SC</span>
                </h1>
                <p class="text-slate-500 font-bold uppercase tracking-[0.3em] text-[10px] mt-4">Escriv√£o de Pol√≠cia / Opera√ß√£o 30 Dias</p>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full md:w-auto">
                <div class="bg-slate-900/40 p-5 rounded-3xl border border-slate-800">
                    <p class="text-[9px] font-bold text-slate-500 uppercase mb-2">M√©dia Geral</p>
                    <p id="stat-rate" class="text-3xl font-black text-yellow-500 italic leading-none">0%</p>
                </div>
                <div class="bg-slate-900/40 p-5 rounded-3xl border border-slate-800">
                    <p class="text-[9px] font-bold text-slate-500 uppercase mb-2">Acertos</p>
                    <p id="stat-acertos" class="text-3xl font-black leading-none">0</p>
                </div>
                <div class="bg-slate-900/40 p-5 rounded-3xl border border-slate-800">
                    <p class="text-[9px] font-bold text-slate-500 uppercase mb-2">Quest√µes</p>
                    <p id="stat-total" class="text-3xl font-black leading-none">0</p>
                </div>
                <div class="bg-slate-900/40 p-5 rounded-3xl border border-yellow-500/30">
                    <p class="text-[9px] font-bold text-yellow-500 uppercase mb-2 italic">Contagem Regressiva</p>
                    <p id="stat-countdown" class="text-3xl font-black leading-none">--</p>
                    <span class="text-[8px] font-bold opacity-40 uppercase">Dias para a prova</span>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-10">
            
            <!-- CALEND√ÅRIO -->
            <div class="lg:col-span-3">
                <div class="flex items-center gap-3 mb-8">
                    <div class="w-1.5 h-8 bg-yellow-500 rounded-full"></div>
                    <h2 class="text-xl font-black uppercase italic tracking-widest">Cronograma Intensivo (20/02 - 21/03)</h2>
                </div>
                
                <div id="calendar-view" class="calendar-grid">
                    <!-- Gerado dinamicamente -->
                </div>
            </div>

            <!-- PAINEL LATERAL -->
            <div class="space-y-6">
                <div class="bg-slate-900/40 border border-slate-800 p-8 rounded-[2rem]">
                    <h3 class="text-white font-black uppercase text-xs mb-6 flex items-center gap-2 italic">
                        üî± Protocolo de Estudo
                    </h3>
                    <div class="space-y-5">
                        <div class="group">
                            <p class="text-[10px] font-black text-blue-400 uppercase mb-1">Bloco Peso (50Q)</p>
                            <p class="text-xs text-slate-400 leading-relaxed italic">Mat√©rias base: Portugu√™s, TI, RLM e Direito Penal.</p>
                        </div>
                        <div class="group">
                            <p class="text-[10px] font-black text-slate-500 uppercase mb-1">Bloco Edital (30Q)</p>
                            <p class="text-xs text-slate-400 leading-relaxed">Varredura de Secund√°rias para cobrir todo o conte√∫do.</p>
                        </div>
                        <div class="p-4 bg-yellow-500/5 border border-yellow-500/10 rounded-2xl">
                            <p class="text-[10px] font-black text-yellow-500 uppercase mb-1">Finais de Semana</p>
                            <p class="text-sm text-white font-black italic">SIMULADO 100Q</p>
                            <p class="text-[9px] text-slate-500 mt-1 uppercase">Padr√£o Real IDECAN (5 Horas)</p>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-900/40 border border-slate-800 p-8 rounded-[2rem]">
                    <h3 class="text-slate-500 font-bold uppercase text-[9px] mb-6 tracking-widest">Evolu√ß√£o Percentual</h3>
                    <canvas id="performanceChart" height="220"></canvas>
                </div>

                <button onclick="resetData()" class="w-full py-5 text-[10px] font-black uppercase tracking-widest text-slate-600 hover:text-red-500 transition-colors bg-slate-900/30 rounded-2xl border border-slate-800">
                    Reiniciar Reta Final
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE REGISTRO -->
    <div id="modal-score" class="hidden fixed inset-0 bg-black/95 backdrop-blur-xl z-[100] flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-800 p-10 rounded-[3rem] w-full max-w-sm shadow-2xl">
            <h2 id="m-date" class="text-4xl font-black text-white italic mb-2 uppercase tracking-tighter">00/00</h2>
            <div id="m-desc" class="mb-10"></div>
            
            <div class="grid grid-cols-2 gap-6 mb-10">
                <div>
                    <label class="text-[9px] font-black text-slate-500 uppercase block mb-2 tracking-widest">Acertos</label>
                    <input type="number" id="in-ac" class="w-full bg-slate-950 border border-slate-800 p-5 text-4xl font-black text-emerald-500 rounded-3xl outline-none focus:border-emerald-500 transition-all text-center">
                </div>
                <div>
                    <label class="text-[9px] font-black text-slate-500 uppercase block mb-2 tracking-widest">Erros</label>
                    <input type="number" id="in-er" class="w-full bg-slate-950 border border-slate-800 p-5 text-4xl font-black text-rose-500 rounded-3xl outline-none focus:border-rose-500 transition-all text-center">
                </div>
            </div>

            <div class="flex gap-4">
                <button onclick="closeModal()" class="flex-1 py-5 text-slate-500 font-bold uppercase text-xs hover:text-white transition-colors">Voltar</button>
                <button onclick="saveScore()" class="flex-1 py-5 bg-yellow-500 text-black font-black uppercase text-xs rounded-2xl hover:bg-yellow-400 shadow-xl shadow-yellow-500/20">Salvar Dados</button>
            </div>
        </div>
    </div>

    <script>
        // Fixador de Datas sem fuso hor√°rio
        const createDate = (y, m, d) => new Date(y, m - 1, d, 12, 0, 0);

        const START_DATE = createDate(2026, 2, 20);
        const END_DATE = createDate(2026, 3, 21);
        const EXAM_DATE = createDate(2026, 3, 22);

        // Planejamento Semanal (50+30 de Seg a Sex, 100 S√°b e Dom)
        const weeklyPlanning = {
            0: { p: "Portugu√™s", s: "Proc. Penal + DH", pm: 50, sm: 30 }, // Segunda
            1: { p: "Inform√°tica (TI)", s: "D. Administrativo", pm: 50, sm: 30 }, // Ter√ßa
            2: { p: "Racioc√≠nio L√≥gico", s: "Contabilidade", pm: 50, sm: 30 }, // Quarta
            3: { p: "Direito Penal", s: "D. Constitucional", pm: 50, sm: 30 }, // Quinta
            4: { p: "TI + Portugu√™s (Mix)", s: "Legis. PC + Adm", pm: 50, sm: 30 }, // Sexta
            5: { p: "SIMULADO GERAL", s: "Estrutura IDECAN", pm: 100, sm: 0 }, // S√°bado
            6: { p: "SIMULADO GERAL", s: "Estrutura IDECAN", pm: 100, sm: 0 }  // Domingo
        };

        let database = JSON.parse(localStorage.getItem('pcsc_reta_final_final_v3')) || {};
        let activeKey = null;
        let mainChart = null;

        function init() {
            renderCalendar();
            refreshStats();
        }

        function renderCalendar() {
            const container = document.getElementById('calendar-view');
            container.innerHTML = '';
            
            let cursor = new Date(START_DATE);

            while (cursor <= END_DATE) {
                const dayKey = cursor.toISOString().split('T')[0];
                const dayOfWeek = cursor.getDay(); // 0: Dom, 1: Seg...
                
                // Index do planning (Segunda=0, Domingo=6)
                const planIdx = (dayOfWeek + 6) % 7; 
                const plan = weeklyPlanning[planIdx];
                const isMockDay = (dayOfWeek === 0 || dayOfWeek === 6);

                const data = database[dayKey] || { ac: 0, er: 0 };
                const totalQ = data.ac + data.er;
                const perc = totalQ > 0 ? ((data.ac / totalQ) * 100).toFixed(0) : 0;

                const card = document.createElement('div');
                card.className = `day-card p-4 rounded-[1.5rem] cursor-pointer flex flex-col justify-between h-40 ${totalQ > 0 ? 'completed' : ''}`;
                
                const dateString = `${cursor.getDate().toString().padStart(2,'0')}/${(cursor.getMonth()+1).toString().padStart(2,'0')}`;
                card.onclick = () => openModal(dayKey, dateString, plan);
                
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <span class="mono text-[10px] font-bold opacity-30 tracking-tighter">${dateString}</span>
                        ${isMockDay ? '<span class="simulado-tag">100Q</span>' : '<span class="weight-tag">80Q</span>'}
                    </div>
                    <div class="mt-2">
                        <p class="text-[11px] font-black uppercase leading-tight text-white mb-1">${plan.p}</p>
                        ${plan.sm > 0 ? `<p class="text-[8px] font-bold text-slate-500 uppercase tracking-tighter">+ ${plan.s}</p>` : ''}
                    </div>
                    <div class="mt-auto">
                        <div class="progress-mini mb-3">
                            <div class="bg-yellow-500 h-full rounded-full" style="width: ${perc}%"></div>
                        </div>
                        <div class="flex items-end justify-between">
                            <span class="text-base font-black italic text-yellow-500 leading-none">${totalQ > 0 ? perc + '%' : '--'}</span>
                            <span class="text-[9px] font-bold text-slate-600 uppercase leading-none">${totalQ}Q</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
                cursor.setDate(cursor.getDate() + 1);
            }
        }

        function openModal(key, dateStr, plan) {
            activeKey = key;
            const isMock = plan.pm === 100;
            
            document.getElementById('m-date').innerText = dateStr;
            document.getElementById('m-desc').innerHTML = `
                <p class="text-yellow-500 font-black text-base uppercase italic mb-2">${plan.p}</p>
                <div class="flex flex-col gap-1">
                    <span class="text-white text-[10px] font-bold uppercase tracking-widest">Meta: ${isMock ? '100 Quest√µes (Simulado)' : '50Q (Peso) + 30Q (Secund√°rias)'}</span>
                    ${!isMock ? `<span class="text-slate-500 text-[9px] font-bold uppercase italic">Secund√°rias: ${plan.s}</span>` : ''}
                </div>
            `;
            
            document.getElementById('in-ac').value = database[key]?.ac || '';
            document.getElementById('in-er').value = database[key]?.er || '';
            document.getElementById('modal-score').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-score').classList.add('hidden');
        }

        function saveScore() {
            const ac = parseInt(document.getElementById('in-ac').value) || 0;
            const er = parseInt(document.getElementById('in-er').value) || 0;
            database[activeKey] = { ac, er };
            localStorage.setItem('pcsc_reta_final_final_v3', JSON.stringify(database));
            closeModal();
            renderCalendar();
            refreshStats();
        }

        function refreshStats() {
            let acTotal = 0, erTotal = 0, qTotal = 0;
            Object.values(database).forEach(v => {
                acTotal += v.ac; erTotal += v.er; qTotal += (v.ac + v.er);
            });

            const currentRate = qTotal > 0 ? ((acTotal / qTotal) * 100).toFixed(1) : 0;
            document.getElementById('stat-rate').innerText = currentRate + "%";
            document.getElementById('stat-acertos').innerText = acTotal;
            document.getElementById('stat-total').innerText = qTotal;

            // L√≥gica de Countdown em tempo real
            const now = new Date();
            const midnightExam = new Date(EXAM_DATE);
            midnightExam.setHours(0,0,0,0);
            
            const diffTime = midnightExam - now;
            const daysRemaining = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('stat-countdown').innerText = daysRemaining > 0 ? daysRemaining : "PROVA";

            renderMainChart();
        }

        function renderMainChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const keys = Object.keys(database).sort();
            const values = keys.map(k => {
                const day = database[k];
                const total = day.ac + day.er;
                return total > 0 ? (day.ac / total * 100) : 0;
            });

            if (mainChart) mainChart.destroy();
            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: keys.map(k => k.split('-')[2]),
                    datasets: [{
                        data: values,
                        borderColor: '#fbbf24',
                        backgroundColor: 'rgba(251, 191, 36, 0.05)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointBackgroundColor: '#fbbf24'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { display: false, min: 0, max: 100 },
                        x: { display: false }
                    }
                }
            });
        }

        function resetData() {
            if(confirm("Confirmar a exclus√£o de todos os registros da Reta Final?")) {
                database = {};
                localStorage.removeItem('pcsc_reta_final_final_v3');
                init();
            }
        }

        window.onload = init;
    </script>
</body>
</html>
